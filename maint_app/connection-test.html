<!DOCTYPE html>
<html>
<head>
    <title>Status Update Test</title>
</head>
<body>
    <h2>Status Update Test</h2>
    
    <div>
        <p>Part ID: 6 (Protect)</p>
        <select id="statusSelect">
            <option>Needs Work</option>
            <option>Parts On Order</option>
            <option>In Progress</option>
            <option>Complete</option>
        </select>
        <button onclick="updateStatus()">Update Status</button>
    </div>

    <div id="result" style="margin-top: 20px;"></div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzL9ffrICvYzdGEnDoj_DV2zoJZQC2wPigydwaG4MZLwAboOwPGBC3BJFsVFn8qt8x0Ww/exec';

        function sanitizeStatus(status) {
            return status.split(' ').join('+').toUpperCase();
        }

        async function updateStatus() {
            const status = document.getElementById('statusSelect').value;
            const sanitizedStatus = sanitizeStatus(status);
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'Updating...';

            try {
                // Making a form data request instead of JSON
                const formData = new FormData();
                formData.append('action', 'updateCell');
                formData.append('partId', '6');
                formData.append('columnName', 'Status');
                formData.append('newValue', sanitizedStatus);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',  // Add this for CORS
                    body: formData
                });

                // Since we're using no-cors, we won't get a readable response
                resultDiv.textContent = 'Update sent. Check Google Sheet for changes.';
                
                // Verify the update after a delay
                setTimeout(async () => {
                    try {
                        const verifyResponse = await fetch(`${API_URL}?action=getAllData`);
                        const data = await verifyResponse.json();
                        resultDiv.textContent += '\nVerification Data: ' + JSON.stringify(data);
                    } catch (verifyError) {
                        resultDiv.textContent += '\nVerification Error: ' + verifyError.message;
                    }
                }, 2000);

            } catch (error) {
                resultDiv.textContent = 'Error: ' + error.message;
                console.error(error);
            }
        }
    </script>
</body>
</html>
